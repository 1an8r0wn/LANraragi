<html>
	<head>
		<title>[% title %] - Database Backup/Restore</title>

		<meta name="viewport" content="width=device-width" />
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

		<link type="image/png" rel="icon" href="./img/favicon.ico" />
		<link rel="stylesheet" type="text/css" href="./node_modules/font-awesome/css/font-awesome.min.css" />
		<link rel="stylesheet" type="text/css" href="./node_modules/blueimp-file-upload/css/jquery.fileupload.css" />

		<script src="./js/css.js" type="text/JAVASCRIPT"></script>
		<script src="./node_modules/jquery/dist/jquery.min.js" type="text/JAVASCRIPT"></script>
		<script src="./js/ajax.js" type="text/JAVASCRIPT"></script>
		<script src="./node_modules/blueimp-file-upload/js/vendor/jquery.ui.widget.js" type="text/JAVASCRIPT"></script>
		<script src="./node_modules/blueimp-file-upload/js/jquery.fileupload.js" type="text/JAVASCRIPT"></script>
		
	</head>

	<body onload="initUpload()">
		
		[% cssdrop %]

		<div class='ido' style='text-align:center'>
				<h2 class='ih' style='text-align:center'>Database Backup/Restore</h2>

					<br>
					You can backup your existing database here, or restore an existing backup.<br><br>
					Backuping allows you to download a JSON file containing all your archive IDs, and their matching metadata.<br>
					Restoring from a backup will restore this metadata, <b>for IDs which already exist in your database.</b><br> 

					<table style='margin:auto; font-size:9pt; margin-top:25px; text-align:center;'><tbody id='files'>
						<tr>
							<td>
								<span class="stdbtn" style="height:50px; display:inline-block" onclick='window.open("./backup?dobackup=1", "_blank")'>
										<i style="padding-top:6px" class="fa fa-download fa-2x"></i><br>
										<span>Backup Database</span>
								</span>
							</td>
							<td>
								<span class="stdbtn fileinput-button" style="height:50px; display:inline-block;">
										<i style="padding-top:6px" class="fa fa-upload fa-2x"></i><br>
										<span>Restore Backup</span>
										<input type="file" id="fileupload" multiple="" name="file"> 
								</span>
							</td>
						</tr>
					</table>
					<br/><br/>

					<span style='margin:auto; font-size:9pt; width: 80%; text-align:center;'>

						<div id='processing' style='display:none'>
							<i class='fa fa-3x fa-cog fa-spin' style='margin-top:20px' id='tag-spinner'></i>
							<h3>Restoring your backup ... </h3>
						</div>

						<h3 id='result'></h3>
						
					</span>


					<br><br><br>
					<input class='stdbtn' type='button' onclick="window.location.replace('./');" value='Return to Library'/>

					
				<br><br>

		</div>

		<script>

		function initUpload(){

			//Set the correct CSS from the user's localStorage.
			set_style_from_storage();

			//Handler for file uploading.
			$('#fileupload').fileupload({
		        dataType: 'json',
		        done: function (e, data) {

		        	$('#processing').attr("style","display:none");

		        	if (data.result.success == 1)
		            	$('#result').html("Backup restored !");
		            else
		            	$('#result').html(data.result.error);
		        },

		        fail: function (e,data) {
		        	$('#processing').attr("style","display:none");
		        	$('#result').html("An error occured server-side. woops.<br/> Maybe your JSON is badly formatted ?");
		        },

		        progressall: function (e, data) {
		        	$('#result').html("");
			        $('#processing').attr("style","");
			    }

		    });

		}
		</script>

	</body>
</html>