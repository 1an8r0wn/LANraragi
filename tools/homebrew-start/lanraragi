#!/bin/bash

trap "kill 0" SIGINT

# prefix/place where lrr is installed
workdir=$(dirname $0)/$(dirname $(readlink $0))/..

if [[ ${OSTYPE} == "darwin"* ]]; then
  _LRR_DATA_DIRECTORY="${HOME}/Library/Application Support/LANraragi"
else
  _LRR_DATA_DIRECTORY="${HOME}/LANraragi"
fi
echo "Data Directory set to ${_LRR_DATA_DIRECTORY}"

# modify redis config
sed -i "" "s~<LRR_DATA_DIRECTORY>~$(printf %q ${_LRR_DATA_DIRECTORY})~g" ${workdir}/redis.conf

# create path if it does not exist yet
mkdir -p ${_LRR_DATA_DIRECTORY}

export LRR_DATA_DIRECTORY="${_LRR_DATA_DIRECTORY}"
redis-server "${workdir}/redis.conf" & npm start --prefix "${workdir}"
