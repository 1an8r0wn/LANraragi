#!/bin/bash

trap "kill 0" SIGINT

# prefix/place where lrr is installed
workdir=$(dirname $0)/$(dirname $(readlink $0))/..

if [[ ${OSTYPE} == "darwin"* ]]; then
  _LRR_DATADIR="${HOME}/Library/Application Support/LANraragi"
else
  _LRR_DATADIR="${HOME}/LANraragi"
fi
# modify redis config
sed -i "s/<LRR_DATADIR>/${_LRR_DATADIR}/g" ${workdir}/redis.conf

export LRR_DATADIR="${_LRR_DATADIR}"
redis-server "${workdir}/redis.conf" & npm start --prefix "${workdir}"
